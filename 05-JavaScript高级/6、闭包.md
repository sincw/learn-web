# 闭包

当函数可以记住并访问所在的作用域时，就产生了闭包。

### 什么是闭包

```javascript
function outer(){
         var scope = "outer";
         function inner(){
            return scope;
         }
         return inner;
      }
      var fn = outer();
      fn();
```

函数inner()的内部作用域能够通过作用域链访问到outer的内部作用域。
outer()内部返回了一个inner函数，当调用outer时，inner函数的作用域链就已经被初始化了（复制父函数的作用域链，再在前端插入自己的活动对象），具体如下图： 

![](imgs/1534687940(1).jpg)

当某个环境中的所有代码执行完毕后，该环境被销毁（弹出环境栈），保存在其中的所有变量和函数也随之销毁（全局执行环境变量直到应用程序退出，如网页关闭才会被销毁） 
但是像上面那种有内部函数的又有所不同，当outer()函数执行结束，执行环境被销毁，但是其关联的活动对象并没有随之销毁，而是一直存在于内存中，因为该活动对象被其内部函数的作用域链所引用。 
具体如下图：
 
 ![](imgs/1534688026(1).jpg)
 
outer执行结束，内部函数开始被调用 
outer执行环境等待被回收，outer的作用域链对全局变量对象和outer的活动对象引用都断了 

内部函数的作用域链仍然保持着对父函数活动对象的引用，就是闭包(closure)。

### 闭包的作用

闭包的主要用途

- 第一个就是可以读取自身函数外部的变量（沿着作用域链寻找） 

- 第二个就是让这些外部变量始终保存在内存中 

用于闭包会使得函数中的变量都保存在内存中，内存消耗增大，所以不能滥用闭包。
闭包可以修改其词法作用域内的变量值，如果其父函数的值被多处应用，这时编码时要小心，
修改变量是否对造成代码错误。
